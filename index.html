<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Radio Arturo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="data:application/json,{
  &quot;name&quot;:&quot;Radio Arturo&quot;,
  &quot;short_name&quot;:&quot;RadioArturo&quot;,
  &quot;start_url&quot;:&quot;.&quot;,
  &quot;display&quot;:&quot;standalone&quot;,
  &quot;background_color&quot;:&quot;#0f172a&quot;,
  &quot;theme_color&quot;:&quot;#38bdf8&quot;
}">

<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config={
 darkMode:'class',
 theme:{extend:{colors:{accent:"#38bdf8",bg:"#0f172a"}}}
}
</script>

<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<style>
body{font-family:system-ui}
::-webkit-scrollbar{display:none}
</style>
</head>

<body class="bg-bg text-white">
<div id="app"></div>

<script type="text/babel">
const {useState,useEffect,useRef}=React

function App(){
const [stations,setStations]=useState([])
const [current,setCurrent]=useState(null)
const [playing,setPlaying]=useState(false)
const [fav,setFav]=useState(JSON.parse(localStorage.getItem("fav")||"[]"))
const [dark,setDark]=useState(true)
const audio=useRef(null)

useEffect(()=>{load("Mexico")},[])

async function load(c){
 const r=await fetch("https://de1.api.radio-browser.info/json/stations/bycountry/"+c)
 const d=await r.json()
 setStations(d.filter(s=>s.url_resolved?.startsWith("https")).slice(0,80))
}

function play(s){
 setCurrent(s)
 setTimeout(()=>audio.current.play(),200)
 setPlaying(true)
}

function toggle(s){
 let f
 if(fav.find(x=>x.stationuuid===s.stationuuid)){
  f=fav.filter(x=>x.stationuuid!==s.stationuuid)
 }else f=[s,...fav]
 setFav(f)
 localStorage.setItem("fav",JSON.stringify(f))
}

return(
<div className={dark?"dark":""}>
<div className="h-screen flex flex-col bg-bg dark:bg-bg bg-white dark:text-white text-black">

<header className="flex justify-between items-center p-4 border-b border-slate-800">
<h1 className="font-bold tracking-wide">Radio Arturo</h1>
<div className="flex gap-3">
<button onClick={()=>setDark(!dark)}><i className="ph ph-moon"></i></button>
<button onClick={()=>load("Mexico")}>MX</button>
<button onClick={()=>load("Venezuela")}>VE</button>
</div>
</header>

<main className="flex-1 overflow-auto divide-y divide-slate-800">
{stations.map(s=>(
<div key={s.stationuuid} className="flex items-center p-3 hover:bg-slate-800/40 cursor-pointer">
<img src={s.favicon||"https://upload.wikimedia.org/wikipedia/commons/8/84/Radio_icon.png"} className="w-10 h-10 rounded"/>
<div onClick={()=>play(s)} className="ml-3 flex-1 truncate">
<div className="font-medium">{s.name}</div>
<div className="text-xs opacity-60">{s.country}</div>
</div>
<button onClick={()=>toggle(s)} className="text-accent">
<i className={`ph ${fav.find(x=>x.stationuuid===s.stationuuid)?"ph-heart-fill":"ph-heart"}`}></i>
</button>
</div>
))}
</main>

<footer className="border-t border-slate-800 p-3 flex items-center gap-3">
{current && <audio ref={audio} src={current.url_resolved}/>}
<img src={current?.favicon} className="w-10 h-10 rounded"/>
<button onClick={()=>{playing?audio.current.pause():audio.current.play();setPlaying(!playing)}} className="text-accent text-2xl">
<i className={`ph ${playing?"ph-pause":"ph-play"}`}></i>
</button>
<div className="flex-1 truncate text-sm">{current?.name||"Selecciona una estaci√≥n"}</div>
<input type="range" min="0" max="1" step="0.01" className="w-24" onChange={e=>audio.current.volume=e.target.value}/>
</footer>

</div>
</div>
)
}

ReactDOM.createRoot(document.getElementById("app")).render(<App/>)
</script>
</body>
</html>
